services:
  dev:
    build:
      context: .
      target: dev
    working_dir: /workspace
    environment:
      GOOGLE_CALENDAR_API_KEY: ${GOOGLE_CALENDAR_API_KEY:-}
      EVENTS_DAYS_AHEAD: ${EVENTS_DAYS_AHEAD:-180}
      HUGO_GOOGLE_ANALYTICS_ID: ${HUGO_GOOGLE_ANALYTICS_ID:-}
    ports:
      - "1313:1313"
    volumes:
      - ./:/workspace
    command: npm run dev:docker

  web:
    build:
      context: .
      target: runtime
      args:
        GOOGLE_CALENDAR_API_KEY: ${GOOGLE_CALENDAR_API_KEY:-}
        EVENTS_DAYS_AHEAD: ${EVENTS_DAYS_AHEAD:-180}
        HUGO_GOOGLE_ANALYTICS_ID: ${HUGO_GOOGLE_ANALYTICS_ID:-}
    environment:
      GOOGLE_CALENDAR_API_KEY: ${GOOGLE_CALENDAR_API_KEY:-}
      EVENTS_DAYS_AHEAD: ${EVENTS_DAYS_AHEAD:-180}
      HUGO_GOOGLE_ANALYTICS_ID: ${HUGO_GOOGLE_ANALYTICS_ID:-}
    ports:
      - "8080:80"
    restart: unless-stopped
